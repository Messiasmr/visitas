<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mobilete Games - Sua Loja de Jogos Favorita</title>
    <link rel="stylesheet" href="/static/style2.css">
    <link rel="stylesheet" href="/static/pagination.css">
</head>
<body>
    <header>
        <div class="header-container">
            {% if user and user['profile_picture'] %}
                <a href="/profile">
                    <img src="/{{ user['profile_picture'] }}" alt="Foto de Perfil" class="profile-logo">
                </a>
            {% else %}
                <a href="/login" class="login-link">Login</a>
            {% endif %}
            <!-- Nome da loja em itálico e clicável -->
            <a href="/" class="store-title" style="text-decoration:none;">
                <span style="font-style:italic; color:#a29bfe; font-size:2.2em;">The Mobilete Games</span>
            </a>
        </div>
        <p>Encontre os melhores jogos e compre diretamente nas lojas oficiais</p>
    </header>
    
    <div class="search-bar">
        <input type="text" id="search-input" placeholder="Procure por um jogo...">
        <button id="search-button">Buscar</button>
    </div>
    
    <div class="games-container" id="games-container">
        <!-- Os jogos serão carregados aqui dinamicamente -->
        <div class="loading">Carregando jogos...</div>
    </div>

    <div class="pagination" id="pagination">
        <!-- Botões de paginação serão gerados dinamicamente -->
    </div>

    <script>
        // Variáveis globais
        const gamesContainer = document.getElementById('games-container');
        const pagination = document.getElementById('pagination');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        const gamesPerPage = 24; // Agora mostra 24 jogos por página
        let currentPage = 1;
        let totalGames = 0;

        // Função para carregar jogos
        async function loadGames(page = 1) {
            gamesContainer.innerHTML = '<div class="loading">Carregando jogos...</div>';
            const search = searchInput.value;
            const response = await fetch(`/api/games?search=${encodeURIComponent(search)}&page=${page}`);
            const data = await response.json();
            const games = data.games;
            totalGames = data.count;

            gamesContainer.innerHTML = '';
            if (!games.length) {
                gamesContainer.innerHTML = '<div class="loading">Nenhum jogo encontrado.</div>';
                pagination.innerHTML = '';
                return;
            }

            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.innerHTML = `
                    <img src="${game.image}" alt="${game.title}" class="game-image">
                    <div class="game-info">
                        <h3 class="game-title">${game.title}</h3>
                        <div class="metacritic-score">Metacritic: ${game.metacritic || 'N/A'}</div>
                        <div class="store-links">
                            ${game.storeLinks.map(link => `
                                <a href="${link.url}" target="_blank" class="store-link">
                                    Comprar na ${link.store}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
                gamesContainer.appendChild(gameCard);
            });

            generatePagination();
        }

        // Função para gerar paginação
        function generatePagination() {
            pagination.innerHTML = '';
            const totalPages = Math.ceil(totalGames / gamesPerPage);

            if (totalPages <= 1) return;

            // Botão anterior
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '<';
                prevBtn.className = 'page-btn';
                prevBtn.onclick = () => {
                    currentPage--;
                    loadGames(currentPage);
                };
                pagination.appendChild(prevBtn);
            }

            // Sempre mostra a primeira página
            addPageButton(1);

            // Reticências antes
            if (currentPage > 4) {
                const dots = document.createElement('span');
                dots.textContent = '...';
                dots.className = 'pagination-dots';
                pagination.appendChild(dots);
            }

            // Páginas vizinhas
            for (let i = Math.max(2, currentPage - 2); i <= Math.min(totalPages - 1, currentPage + 2); i++) {
                addPageButton(i);
            }

            // Reticências depois
            if (currentPage < totalPages - 3) {
                const dots = document.createElement('span');
                dots.textContent = '...';
                dots.className = 'pagination-dots';
                pagination.appendChild(dots);
            }

            // Sempre mostra a última página
            if (totalPages > 1) addPageButton(totalPages);

            // Botão próximo
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '>';
                nextBtn.className = 'page-btn';
                nextBtn.onclick = () => {
                    currentPage++;
                    loadGames(currentPage);
                };
                pagination.appendChild(nextBtn);
            }

            function addPageButton(page) {
                const btn = document.createElement('button');
                btn.textContent = page;
                btn.className = 'page-btn' + (page === currentPage ? ' active' : '');
                btn.onclick = () => {
                    currentPage = page;
                    loadGames(currentPage);
                };
                pagination.appendChild(btn);
            }
        }

        // Event Listeners
        searchButton.addEventListener('click', () => {
            loadGames(1);
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadGames(1);
            }
        });

        // Carrega jogos ao iniciar
        loadGames();
    </script>
</body>
</html>